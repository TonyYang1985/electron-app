# GitHub Workflow æ„å»ºå’Œå‘å¸ƒæ–‡æ¡£

## æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ GitHub Actions å·¥ä½œæµç¨‹ï¼Œç”¨äºè‡ªåŠ¨åŒ–æ„å»ºå’Œå‘å¸ƒ Electron åº”ç”¨ç¨‹åºã€‚æ”¯æŒå¤šå¹³å°æ„å»ºï¼ˆWindowsã€macOSã€Linuxï¼‰å’Œå¤šç¯å¢ƒå‘å¸ƒï¼ˆPRODã€DEVã€SITã€DEMOï¼‰ã€‚

## å·¥ä½œæµç¨‹ç‰¹æ€§

### ğŸš€ æ ¸å¿ƒåŠŸèƒ½

- **å¤šå¹³å°æ„å»º**: Windowsã€macOSã€Linux åŒæ—¶æ„å»º
- **å¤šç¯å¢ƒæ”¯æŒ**: PRODã€DEVã€SITã€DEMO å››ç§ç¯å¢ƒ
- **æ™ºèƒ½ç¯å¢ƒè§£æ**: ä» Git æ ‡ç­¾è‡ªåŠ¨è§£æç¯å¢ƒ
- **TypeScript ç¼–è¯‘**: è‡ªåŠ¨ç¼–è¯‘ TypeScript ä»£ç 
- **è‡ªåŠ¨å‘å¸ƒ**: æ„å»ºæˆåŠŸåè‡ªåŠ¨åˆ›å»º GitHub Release
- **å·¥ä»¶ç®¡ç†**: è‡ªåŠ¨ä¸Šä¼ å’Œæ¸…ç†æ„å»ºäº§ç‰©

### ğŸ¯ è§¦å‘æ¡ä»¶

1. **Git æ ‡ç­¾æ¨é€**: `v*` æ ¼å¼çš„æ ‡ç­¾ï¼ˆå¦‚ `v1.0.44-dev`ï¼‰
2. **æ‰‹åŠ¨è§¦å‘**: é€šè¿‡ GitHub Actions ç•Œé¢æ‰‹åŠ¨è¿è¡Œ

## ç¯å¢ƒé…ç½®

### æ”¯æŒçš„ç¯å¢ƒç±»å‹

| ç¯å¢ƒ | æ ‡ç­¾åç¼€ | æè¿° | å‘å¸ƒç±»å‹ |
|------|----------|------|----------|
| PROD | `-prod`, `-production` | ç”Ÿäº§ç¯å¢ƒ | æ­£å¼å‘å¸ƒ (latest) |
| DEV | `-dev`, `-development` | å¼€å‘ç¯å¢ƒ | é¢„å‘å¸ƒç‰ˆæœ¬ |
| SIT | `-sit`, `-staging` | æµ‹è¯•ç¯å¢ƒ | é¢„å‘å¸ƒç‰ˆæœ¬ |
| DEMO | `-demo`, `-demonstration` | æ¼”ç¤ºç¯å¢ƒ | é¢„å‘å¸ƒç‰ˆæœ¬ |

### æ ‡ç­¾æ ¼å¼ç¤ºä¾‹

```bash
v1.0.44-prod    # ç”Ÿäº§ç¯å¢ƒ
v1.0.44-dev     # å¼€å‘ç¯å¢ƒ
v1.0.44-sit     # æµ‹è¯•ç¯å¢ƒ
v1.0.44-demo    # æ¼”ç¤ºç¯å¢ƒ
v1.0.44         # é»˜è®¤ä¸ºç”Ÿäº§ç¯å¢ƒ
```

## æ„å»ºçŸ©é˜µ

### æ”¯æŒçš„å¹³å°

| å¹³å° | è¿è¡Œç¯å¢ƒ | æ„å»ºå‘½ä»¤ | è¾“å‡ºæ ¼å¼ |
|------|----------|----------|----------|
| Windows | `windows-latest` | `npm run build:win` | `.exe`, `.blockmap` |
| macOS | `macos-latest` | `npm run build:mac` | `.dmg`, `.blockmap` |
| Linux | `ubuntu-latest` | `npm run build:linux` | `.AppImage`, `.deb`, `.rpm` |

## å·¥ä½œæµç¨‹æ­¥éª¤

### 1. æ„å»ºé˜¶æ®µ (build)

#### ç¯å¢ƒè§£æ

```yaml
- name: è§£æç¯å¢ƒä¿¡æ¯
  id: parse_env
  # ä»æ ‡ç­¾æˆ–æ‰‹åŠ¨è¾“å…¥è§£ææ„å»ºç¯å¢ƒ
  # æ”¯æŒå¤§å°å†™ä¸æ•æ„Ÿçš„ç¯å¢ƒåç¼€è¯†åˆ«
```

#### TypeScript ç¼–è¯‘

```yaml
- name: ç¼–è¯‘å’Œå‡†å¤‡æ–‡ä»¶
  run: npm run build
  # ç¼–è¯‘ TypeScript ä»£ç åˆ° release/ ç›®å½•
```

#### æ„å»ºéªŒè¯

```yaml
- name: éªŒè¯æ„å»ºç»“æœ
  # æ£€æŸ¥ TypeScript ç¼–è¯‘ç»“æœ
  # éªŒè¯æ„å»ºæ–‡ä»¶æ˜¯å¦ç”ŸæˆæˆåŠŸ
```

#### Git ç¯å¢ƒæ¸…ç†

```yaml
- name: æ¸…ç†Gitæ ‡ç­¾ç¯å¢ƒ
  # é˜²æ­¢ electron-builder è‡ªåŠ¨å‘å¸ƒ
  # ç§»é™¤æ‰€æœ‰æ ‡ç­¾å’Œè¿œç¨‹å¼•ç”¨
```

#### å¹³å°æ„å»º

```yaml
- name: æ„å»º ${{ matrix.name }}
  run: npm run build:${{ matrix.platform }}
  env:
    CSC_IDENTITY_AUTO_DISCOVERY: false
    BUILD_ENVIRONMENT: ${{ steps.parse_env.outputs.BUILD_ENVIRONMENT }}
```

### 2. å‘å¸ƒé˜¶æ®µ (release)

#### æ–‡ä»¶æ•´ç†

```yaml
- name: æ•´ç†å‘å¸ƒæ–‡ä»¶
  # æ”¶é›†æ‰€æœ‰å¹³å°çš„æ„å»ºäº§ç‰©
  # ç»Ÿè®¡æ–‡ä»¶æ•°é‡å’Œå¤§å°
```

#### Release åˆ›å»º

```yaml
- name: åˆ›å»ºGitHub Release
  uses: softprops/action-gh-release@v2
  # æ ¹æ®ç¯å¢ƒç±»å‹å†³å®šæ˜¯å¦ä¸ºé¢„å‘å¸ƒç‰ˆæœ¬
  # ç”Ÿæˆè¯¦ç»†çš„å‘å¸ƒè¯´æ˜
```

### 3. æ¸…ç†é˜¶æ®µ (cleanup)

```yaml
- name: æ¸…ç†æ„å»ºå·¥ä»¶
  uses: geekyeggo/delete-artifact@v5
  # è‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ„å»ºå·¥ä»¶
```

## ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•ä¸€: Git æ ‡ç­¾è§¦å‘

```bash
# åˆ›å»ºå¹¶æ¨é€æ ‡ç­¾
git tag v1.0.44-dev
git push origin v1.0.44-dev

# æˆ–è€…ä¸€æ¬¡æ€§åˆ›å»ºå¤šç¯å¢ƒæ ‡ç­¾
git tag v1.0.44-dev
git tag v1.0.44-sit  
git tag v1.0.44-demo
git tag v1.0.44-prod
git push origin --tags
```

### æ–¹æ³•äºŒ: æ‰‹åŠ¨è§¦å‘

1. è¿›å…¥ GitHub ä»“åº“çš„ **Actions** é¡µé¢
2. é€‰æ‹© **æ„å»ºå’Œå‘å¸ƒ** å·¥ä½œæµç¨‹
3. ç‚¹å‡» **Run workflow**
4. å¡«å†™å‚æ•°ï¼š
   - **ç‰ˆæœ¬å·**: å¦‚ `1.0.44`
   - **æ„å»ºç¯å¢ƒ**: é€‰æ‹© PROD/DEV/SIT/DEMO

## è¾“å‡ºäº§ç‰©

### Windows å¹³å°

- `my-awesome-app-*-win-x64.exe` - NSIS å®‰è£…ç¨‹åº
- `my-awesome-app-*-win-x64.exe.blockmap` - æ ¡éªŒæ–‡ä»¶

### macOS å¹³å°

- `my-awesome-app-*-mac-x64.dmg` - Intel Mac å®‰è£…åŒ…
- `my-awesome-app-*-mac-arm64.dmg` - Apple Silicon å®‰è£…åŒ…
- å¯¹åº”çš„ `.blockmap` æ ¡éªŒæ–‡ä»¶

### Linux å¹³å°

- `my-awesome-app-*-linux-x64.AppImage` - é€šç”¨ä¾¿æºç‰ˆ
- `my-awesome-app-*-linux-amd64.deb` - Debian/Ubuntu åŒ…
- `my-awesome-app-*-linux-x86_64.rpm` - CentOS/Fedora åŒ…

## ç¯å¢ƒå˜é‡

### å¿…éœ€çš„ Secrets

- `GITHUB_TOKEN` - GitHub è‡ªåŠ¨æä¾›ï¼Œç”¨äºåˆ›å»º Release

### æ„å»ºç¯å¢ƒå˜é‡

- `BUILD_ENVIRONMENT` - å½“å‰æ„å»ºç¯å¢ƒ (PROD/DEV/SIT/DEMO)
- `CSC_IDENTITY_AUTO_DISCOVERY` - ç¦ç”¨ä»£ç ç­¾åè‡ªåŠ¨å‘ç°

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. TypeScript ç¼–è¯‘å¤±è´¥

```bash
# æ£€æŸ¥ç¼–è¯‘é”™è¯¯
npm run build
# æˆ–è€…
npx tsc --noEmit
```

#### 2. æ„å»ºæ–‡ä»¶æœªæ‰¾åˆ°

- æ£€æŸ¥ `electron-builder.json` é…ç½®
- ç¡®è®¤è¾“å‡ºç›®å½•è®¾ç½®æ­£ç¡®
- éªŒè¯ `package.json` ä¸­çš„æ„å»ºè„šæœ¬

#### 3. Git æ ‡ç­¾ç¯å¢ƒè§£æå¤±è´¥

- ç¡®ä¿æ ‡ç­¾æ ¼å¼æ­£ç¡®: `v{version}-{env}`
- ç¯å¢ƒåç¼€å¿…é¡»æ˜¯: dev, sit, demo, prod
- æ”¯æŒå¤§å°å†™ä¸æ•æ„Ÿ

#### 4. Release åˆ›å»ºå¤±è´¥

- æ£€æŸ¥ `GITHUB_TOKEN` æƒé™
- ç¡®è®¤ä»“åº“æœ‰ `contents: write` æƒé™
- éªŒè¯æ ‡ç­¾æ˜¯å¦å·²å­˜åœ¨

### è°ƒè¯•æ­¥éª¤

1. **æ£€æŸ¥å·¥ä½œæµç¨‹æ—¥å¿—**
   ```
   GitHub â†’ Actions â†’ é€‰æ‹©å¤±è´¥çš„è¿è¡Œ â†’ æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
   ```

2. **æœ¬åœ°éªŒè¯æ„å»º**
   ```bash
   npm ci
   npm run build
   npm run build:win  # æˆ– build:mac, build:linux
   ```

3. **éªŒè¯ç¯å¢ƒé…ç½®**
   ```bash
   # æ£€æŸ¥ç¯å¢ƒæ–‡ä»¶
   ls -la env/
   cat env/PROD.json  # æˆ–å…¶ä»–ç¯å¢ƒæ–‡ä»¶
   ```

## é…ç½®æ–‡ä»¶ä¾èµ–

### å¿…éœ€çš„é…ç½®æ–‡ä»¶

- `package.json` - é¡¹ç›®é…ç½®å’Œæ„å»ºè„šæœ¬
- `electron-builder.json` - Electron æ„å»ºé…ç½®
- `tsconfig.json` - TypeScript ç¼–è¯‘é…ç½®
- `env/*.json` - ç¯å¢ƒé…ç½®æ–‡ä»¶

### æ¨èçš„ package.json è„šæœ¬

```json
{
  "scripts": {
    "build": "npm run build:ts && npm run copy:assets",
    "build:ts": "tsc",
    "build:win": "electron-builder --win",
    "build:mac": "electron-builder --mac", 
    "build:linux": "electron-builder --linux",
    "build:all": "electron-builder --win --mac --linux"
  }
}
```

## æœ€ä½³å®è·µ

### 1. ç‰ˆæœ¬ç®¡ç†

- ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬å· (Semantic Versioning)
- ä¸ºä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„æ ‡ç­¾åç¼€
- ä¿æŒç‰ˆæœ¬å·çš„ä¸€è‡´æ€§

### 2. ç¯å¢ƒéš”ç¦»

- æ¯ä¸ªç¯å¢ƒä½¿ç”¨ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶
- æ„å»ºäº§ç‰©æŒ‰ç¯å¢ƒåˆ†åˆ«å­˜å‚¨
- å‘å¸ƒç­–ç•¥æŒ‰ç¯å¢ƒåŒºåˆ†

### 3. å®‰å…¨è€ƒè™‘

- ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
- ä½¿ç”¨ GitHub Secrets ç®¡ç†æ•æ„Ÿé…ç½®
- å®šæœŸæ›´æ–°ä¾èµ–é¡¹å’Œ Actions ç‰ˆæœ¬

### 4. æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨ npm cache åŠ é€Ÿä¾èµ–å®‰è£…
- å¹¶è¡Œæ„å»ºå¤šä¸ªå¹³å°
- åŠæ—¶æ¸…ç†ä¸´æ—¶æ–‡ä»¶

## æ›´æ–°å’Œç»´æŠ¤

### å®šæœŸç»´æŠ¤ä»»åŠ¡

1. æ›´æ–° GitHub Actions ç‰ˆæœ¬
2. æ›´æ–° Node.js å’Œ Electron ç‰ˆæœ¬
3. æ£€æŸ¥å’Œæ›´æ–°ä¾èµ–é¡¹
4. æµ‹è¯•å„å¹³å°æ„å»ºç»“æœ

### ç‰ˆæœ¬å‡çº§æŒ‡å—

1. æ›´æ–° `package.json` ä¸­çš„ç‰ˆæœ¬å·
2. æ›´æ–°ç›¸å…³é…ç½®æ–‡ä»¶
3. æµ‹è¯•æœ¬åœ°æ„å»º
4. åˆ›å»ºå¯¹åº”çš„ Git æ ‡ç­¾
5. éªŒè¯è‡ªåŠ¨åŒ–æ„å»ºå’Œå‘å¸ƒ

---

## è”ç³»å’Œæ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- åˆ›å»º GitHub Issue
- æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£
- å‚è€ƒ GitHub Actions å®˜æ–¹æ–‡æ¡£
